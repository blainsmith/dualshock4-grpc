package playstation_test

import (
	"fmt"
	"testing"

	"github.com/blainsmith/dualshock4-grpc/playstation"
)

func TestParseDS4Frame(t *testing.T) {
	t.Run("returns an error with an invalid frame", func(t *testing.T) {
		frame := []byte{}
		ds4frame := playstation.DS4Frame{}
		err := ds4frame.UnmarshalText(frame)
		if err == nil {
			t.Fail()
		}
	})

	t.Run("parses resting state frame", func(t *testing.T) {
		frame := []byte{0x01, 0x7e, 0x7f, 0x83, 0x81, 0x08, 0x00, 0x84, 0x00, 0x00, 0x93, 0x31, 0xfd, 0x70, 0x00, 0xef, 0xff, 0x32, 0x00, 0x7d, 0xf9, 0xab, 0x20, 0x05, 0xfa, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1b, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00}
		ds4frame := playstation.DS4Frame{}
		err := ds4frame.UnmarshalText(frame)
		if err != nil {
			t.Fail()
		}
		fmt.Printf("%+v\n", ds4frame)
	})

	t.Run("", func(t *testing.T) {
		frame := []byte{0x01, 0x7e, 0x7f, 0x83, 0x81, 0x98, 0x01, 0x84, 0x00, 0x00, 0x93, 0x31, 0xfd, 0x70, 0x00, 0xef, 0xff, 0x32, 0x00, 0x7d, 0xf9, 0xab, 0x20, 0x05, 0xfa, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1b, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00}
		ds4frame := playstation.DS4Frame{}
		err := ds4frame.UnmarshalText(frame)
		if err != nil {
			t.Fail()
		}
		fmt.Printf("%+v\n", ds4frame)
	})
}
